<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>client &mdash; Documentation Seleenix 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=05dadb3a"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=d99ca74e"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Seleenix
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">SAE302</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Seleenix</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Code du module</a></li>
      <li class="breadcrumb-item active">client</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Code source de client</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Cet extrait de code est un programme client qui se connecte à un serveur à l&#39;aide d&#39;une connexion socket. Il permet à l&#39;utilisateur d&#39;interagir avec le serveur en envoyant et en recevant des messages. Le programme utilise l&#39;algorithme de chiffrement AES pour crypter et décrypter les messages. Il inclut également des fonctionnalités pour gérer les annonces du serveur et rechercher des serveurs sur le réseau local.</span>

<span class="sd">L&#39;utilisation de code ANSI permet de correctement positionner le terminal afin d&#39;éviter de rencontrer des artéfacts visuels,</span>
<span class="sd">on ne peut malheureusement gérer tous ces artifacts.</span>


<span class="sd">Exemple d&#39;utilisation :</span>
<span class="sd">python client.py --host 127.0.0.1 --port 1234</span>

<span class="sd">Entrées :</span>
<span class="sd">- host (chaîne de caractères) : L&#39;adresse IP du serveur à connecter. La valeur par défaut est &quot;127.0.0.1&quot;.</span>
<span class="sd">- port (entier) : Le numéro de port du serveur à connecter. La valeur par défaut est 1234.</span>
<span class="sd">- search (booléen) : Drapeau pour activer le mode de recherche de serveur. La valeur par défaut est False.</span>

<span class="sd">Déroulement :</span>
<span class="sd">1. Analyser les arguments de la ligne de commande pour obtenir l&#39;adresse du serveur, le port et le drapeau de recherche.</span>
<span class="sd">2. Créer un objet socket pour le client.</span>
<span class="sd">3. Si le mode de recherche est activé, vérifier si le client s&#39;exécute sur une machine virtuelle. Si ce n&#39;est pas le cas, rechercher des serveurs sur le réseau local en utilisant des paquets UDP.</span>
<span class="sd">4. Si un serveur est trouvé, se connecter à celui-ci en utilisant l&#39;adresse et le port.</span>
<span class="sd">5. Demander à l&#39;utilisateur un nom d&#39;utilisateur et un mot de passe.</span>
<span class="sd">6. Générer une chaîne de défi et l&#39;envoyer au serveur avec le nom d&#39;utilisateur et le mot de passe, cryptés à l&#39;aide de AES.</span>
<span class="sd">7. Recevoir la réponse du serveur et vérifier si le défi a été accepté.</span>
<span class="sd">8. Si le défi est accepté, afficher un message de bienvenue et entrer en mode interactif.</span>
<span class="sd">9. En mode interactif, démarrer deux threads : un pour envoyer des messages et un pour recevoir des messages.</span>
<span class="sd">10. Dans le thread d&#39;envoi, demander à l&#39;utilisateur un message et l&#39;envoyer au serveur.</span>
<span class="sd">11. Si le message est &quot;/query&quot;, envoyer une demande de requête au serveur.</span>
<span class="sd">12. Si le message est &quot;/accept&quot; ou &quot;/refuse&quot;, envoyer une demande d&#39;acceptation ou de refus d&#39;une requête.</span>
<span class="sd">13. Si le message est &quot;/unsubscribe&quot;, se désabonner de la salle actuelle.</span>
<span class="sd">14. Si le message est &quot;bye&quot; ou &quot;arret&quot;, fermer la connexion et quitter le programme.</span>
<span class="sd">15. Dans le thread de réception, recevoir des messages du serveur et les afficher.</span>
<span class="sd">16. Si un message est reçu avec le préfixe &quot;cmd:&quot;, afficher la sortie de la commande.</span>
<span class="sd">17. Si un message est reçu avec le préfixe &quot;users:&quot;, afficher la liste des utilisateurs.</span>
<span class="sd">18. Si un message est reçu avec le préfixe &quot;jn:&quot;, afficher la réponse à la jointure.</span>
<span class="sd">19. Si un message est reçu avec le préfixe &quot;query:&quot;, afficher la réponse à la requête.</span>
<span class="sd">20. Si un message est reçu avec le préfixe &quot;us:&quot;, afficher la réponse au désabonnement.</span>
<span class="sd">21. Si un message est reçu avec le préfixe &quot;fwd:&quot;, afficher un message transféré.</span>
<span class="sd">22. Si un message est reçu avec le préfixe &quot;old:&quot;, restaurer les anciens messages.</span>
<span class="sd">23. Si un message est reçu avec le préfixe &quot;bye&quot; ou &quot;arret&quot;, fermer la connexion et quitter le programme.</span>

<span class="sd">Sorties :</span>
<span class="sd">- Le programme affiche divers messages et invites à l&#39;utilisateur.</span>
<span class="sd">- Le programme envoie et reçoit des messages vers et depuis le serveur.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">colorama</span> <span class="kn">import</span> <span class="n">init</span><span class="p">,</span> <span class="n">Fore</span><span class="p">,</span> <span class="n">Back</span><span class="p">,</span> <span class="n">Style</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.Padding</span> <span class="kn">import</span> <span class="n">pad</span><span class="p">,</span> <span class="n">unpad</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">getoutput</span> <span class="k">as</span> <span class="n">getResults</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># configuration client</span>
<span class="n">init</span><span class="p">(</span><span class="n">autoreset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># pour que les couleurs s&#39;appliquent à tout le terminal</span>
<span class="k">global</span> <span class="n">connected</span>    
<span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="c1"># récupérer depuis les variables d&#39;environnements</span>
<span class="n">iv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AES_IV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="c1">#récupérer depuis les variables d&#39;environnements</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>


<div class="viewcode-block" id="ChallengeRefused">
<a class="viewcode-back" href="../client.html#client.ChallengeRefused">[docs]</a>
<span class="k">class</span> <span class="nc">ChallengeRefused</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="c1"># erreur customisée en lien avec le challenge</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ConnectionClosedByServer">
<a class="viewcode-back" href="../client.html#client.ConnectionClosedByServer">[docs]</a>
<span class="k">class</span> <span class="nc">ConnectionClosedByServer</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="KickedFromRoom">
<a class="viewcode-back" href="../client.html#client.KickedFromRoom">[docs]</a>
<span class="k">class</span> <span class="nc">KickedFromRoom</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="BannedFromServer">
<a class="viewcode-back" href="../client.html#client.BannedFromServer">[docs]</a>
<span class="k">class</span> <span class="nc">BannedFromServer</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

     
         
        
<div class="viewcode-block" id="cls">
<a class="viewcode-back" href="../client.html#client.cls">[docs]</a>
<span class="k">def</span> <span class="nf">cls</span><span class="p">():</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span></div>


<span class="c1"># Instancier les arguments</span>
<div class="viewcode-block" id="arg_parse">
<a class="viewcode-back" href="../client.html#client.arg_parse">[docs]</a>
<span class="k">def</span> <span class="nf">arg_parse</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction permettant de récupérer les arguments de la ligne de commande.</span>
<span class="sd">    Mais aussi d&#39;ajouter des explicatifs sur les arguments.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        args (obj): Les arguments de la ligne de commande.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Client pour le chat&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--host&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;L</span><span class="se">\&#39;</span><span class="s1">ip du serveur hôte&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--port&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Le port du serveur hôte&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--search&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Activer la recherche (flag)&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span></div>


<div class="viewcode-block" id="encrypt">
<a class="viewcode-back" href="../client.html#client.encrypt">[docs]</a>
<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span> <span class="c1"># pour automatiser encryption</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encrypter un payload donné en utilisant l&#39;algorithme de chiffrement AES.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        payload (bytes): Le payload à chiffrer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: Le payload chiffré.</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span> <span class="c1"># nouveau cipher pour chaque message</span>
    <span class="k">return</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span></div>


<div class="viewcode-block" id="decrypt">
<a class="viewcode-back" href="../client.html#client.decrypt">[docs]</a>
<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span> <span class="c1"># pour automatiser decryption</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decrypter un payload donné en utilisant l&#39;algorithme de chiffrement AES.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        payload (bytes): Le payload à déchiffrer.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: Le payload déchiffré.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span> <span class="c1"># nouveau cipher pour chaque message</span>
    <span class="k">return</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span></div>


<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../client.html#client.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    La fonction main est le point d&#39;entrée du programme client. Elle est responsable de la connexion au serveur, de la gestion du processus de défi, et du démarrage du mode interactif pour l&#39;envoi et la réception de messages.</span>

<span class="sd">    Args:</span>
<span class="sd">        host (str) : L&#39;adresse IP du serveur auquel se connecter.</span>
<span class="sd">        port (int) : Le numéro de port du serveur auquel se connecter.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises :</span>
<span class="sd">        ChallengeRefused : Si le serveur refuse le défi.</span>
<span class="sd">        ConnectionClosedByServer : Si le serveur ferme la connexion de manière inattendue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">username</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Username: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;default&quot;</span>
    <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Password: &quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Password: &quot;</span><span class="p">)</span>
    <span class="n">challenge</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">65535</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)])</span> <span class="c1"># un challenge pour reconnaître une connexion autorisée</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span><span class="n">challenge</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="n">client_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">encrypt</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
        <span class="n">synced</span> <span class="o">=</span> <span class="n">client_socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="c1"># on attend la réponse du serveur pour continuer</span>
        <span class="k">if</span> <span class="s2">&quot;banni&quot;</span> <span class="ow">in</span> <span class="n">synced</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BannedFromServer</span><span class="p">(</span><span class="n">synced</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="s2">&quot;synced&quot;</span> <span class="ow">in</span> <span class="n">synced</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ChallengeRefused</span><span class="p">(</span><span class="s2">&quot;You&#39;re not allowed to access to this server...&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">BannedFromServer</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">ChallengeRefused</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ConnectionRefusedError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="se">\n</span><span class="s2">La connexion n&#39;a pas aboutie, vérifiez que le serveur est bien lancé et que l&#39;adresse est correcte&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">room</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">synced</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">room</span> <span class="o">=</span> <span class="n">synced</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="c1">#print(Fore.GREEN + &quot;You&#39;re connected to the server !&quot;)</span>
        <span class="bp">cls</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Welcome </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> !&quot;</span><span class="p">)</span> 
        <span class="n">interactive</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="mi">0</span> <span class="c1">#print(host,port,challenge)</span></div>



<div class="viewcode-block" id="send">
<a class="viewcode-back" href="../client.html#client.send">[docs]</a>
<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Envoie un message du client au serveur</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">       socket (socket): Le socket du client.</span>
<span class="sd">        host (str): L&#39;adresse IP du serveur.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        ConnectionAbortedError : Si la connexion est interrompue par le serveur.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">global</span> <span class="n">room</span>
    <span class="k">global</span> <span class="n">connected</span>
    <span class="k">global</span> <span class="n">msg</span>
    <span class="k">while</span> <span class="n">connected</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s2"> $:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1A</span><span class="se">\033</span><span class="s2">[2K&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># up + clear line </span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;you: &quot;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">msg</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="c1">#print(&#39;\033[1F&#39;,f&#39;\n&#39;, end=&quot;&quot;) if msg else None # descebdre le curseur et afficher le prompt</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span> <span class="k">if</span> <span class="n">msg</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;bye&quot;</span> <span class="ow">or</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;arret&quot;</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>
            
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/query&quot;</span><span class="p">):</span> <span class="c1"># afficher requête pour admin</span>
                <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;Le format de la commande est incorrect !&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">final_request</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">username</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">final_request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                
            <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/accept&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/refuse&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;/accept&quot;</span> <span class="ow">or</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;/refuse&quot;</span><span class="p">):</span> <span class="c1"># accepter ou refuser une requête</span>
                
                <span class="n">id_selected</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">final_request</span> <span class="o">=</span> <span class="n">new_msg</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">id_selected</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">final_request</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            
            <span class="k">if</span> <span class="s2">&quot;/unsubscribe&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
                <span class="n">room</span> <span class="o">=</span> <span class="s2">&quot;General&quot;</span>
                <span class="bp">cls</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">La connexion a été interrompue par le serveur&quot;</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;bye&quot;</span> \
                    <span class="k">else</span> <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Vous avez bien été déconnecté du serveur&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">pass</span>       
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="receive">
<a class="viewcode-back" href="../client.html#client.receive">[docs]</a>
<span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recevoir un message du serveur et l&#39;afficher</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        socket (socket): Le socket du client.</span>
<span class="sd">        host (str): L&#39;adresse IP du serveur.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        ConnectionClosedByServer : Si le serveur ferme la connexion de manière inattendue.</span>
<span class="sd">        KickedFromRoom : Si le client est kick du salon.</span>
<span class="sd">        ConnectionAbortedError : Si la connexion est interrompue par le serveur.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">room</span>
    <span class="k">global</span> <span class="n">connected</span>
    <span class="k">global</span> <span class="n">msg</span> <span class="c1"># récupérer le dernier msg envoyé par le client</span>
    <span class="k">while</span> <span class="n">connected</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\033</span><span class="s2">[2K&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># carriage return + clear line</span>
            
            <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cmd:&quot;</span><span class="p">):</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;cmd:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;alw:&quot;</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="s2">&quot;alw:&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;alw:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; (Unlocked)&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s2">&quot; (Locked)&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                    
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;users:&quot;</span><span class="p">):</span> <span class="c1"># le serveur renvoie la liste des utilisateurs</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;users:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">user</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&quot; (You)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">YELLOW</span> <span class="o">+</span> <span class="n">user</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                
                
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;jn:&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;kick&#39;</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
                    
                <span class="n">TimeKick</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;time:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                
                
                <span class="k">raise</span> <span class="n">KickedFromRoom</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">TimeKick</span><span class="p">))</span>
                
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;jn:&quot;</span><span class="p">):</span> <span class="c1"># le serveur renvoie la réponse du /join</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;jn:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="s2">&quot;Succès&quot;</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
                    <span class="n">room</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Bienvenue dans le salon </span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s2"> !&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="n">reply</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
            
            
                
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;query:&quot;</span><span class="p">):</span> <span class="c1"># le serveur</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;query:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="c1"># pour changer le string avec les &quot;[]&quot; en vrai liste</span>
                    
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;us:&quot;</span><span class="p">):</span> <span class="c1"># le serveur renvoie la réponse du /unsubscribe</span>
                <span class="bp">cls</span><span class="p">()</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;us:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="s2">&quot;désabonné&quot;</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
                    <span class="n">room</span> <span class="o">=</span> <span class="s2">&quot;General&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Vous avez bien été désabonné du salon !&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="n">reply</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fwd:&quot;</span><span class="p">):</span> <span class="c1"># le serveur forward une réponse d&#39;un client dans le même salon</span>
                <span class="n">fwd_user</span><span class="p">,</span> <span class="n">fwd_reply</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;fwd:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;fwd:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">LIGHTBLUE_EX</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fwd_user</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">Fore</span><span class="o">.</span><span class="n">RESET</span><span class="si">}{</span><span class="n">fwd_reply</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                
            <span class="k">elif</span> <span class="n">reply</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;old:&quot;</span><span class="p">):</span><span class="c1"># le serveur renvoie les anciens messages</span>
                <span class="n">restore_old_messages</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
                
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;server: &quot;</span><span class="p">,</span><span class="n">reply</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1F&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">room</span><span class="si">}</span><span class="s1"> $:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">reply</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># descebdre le curseur et afficher le prompt</span>
            
            <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s2">&quot;bye&quot;</span> <span class="ow">or</span> <span class="n">reply</span> <span class="o">==</span> <span class="s2">&quot;arret&quot;</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">ConnectionClosedByServer</span><span class="p">(</span><span class="s1">&#39;closed connection&#39;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">ConnectionClosedByServer</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Vous avez bien été déconnecté du serveur&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="n">KickedFromRoom</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Vous avez été kick du salon par le serveur jusque </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        
        <span class="k">except</span> <span class="ne">ConnectionAbortedError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;La connexion a été interrompue par le serveur&quot;</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;bye&quot;</span> \
                    <span class="k">else</span> <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Vous avez bien été déconnecté du serveur&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">pass</span>
        
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="restore_old_messages">
<a class="viewcode-back" href="../client.html#client.restore_old_messages">[docs]</a>
<span class="k">def</span> <span class="nf">restore_old_messages</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Permet de restaurer les anciens messages du salon actuel.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        payload (str): Les anciens messages du salon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        None (contrôlé par serveur)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_messages</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;old:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    
    <span class="c1"># restaure les messages du salon actuel</span>
    <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">all_messages</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">LIGHTBLUE_EX</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">Fore</span><span class="o">.</span><span class="n">RESET</span><span class="si">}{</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span> \
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">username</span> \
                <span class="k">else</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;you: </span><span class="si">{</span><span class="n">Fore</span><span class="o">.</span><span class="n">RESET</span><span class="si">}{</span><span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
                
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="interactive">
<a class="viewcode-back" href="../client.html#client.interactive">[docs]</a>
<span class="k">def</span> <span class="nf">interactive</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction permettant d&#39;initier le mode interactif du client.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        host (str): L&#39;adresse IP du serveur.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        None</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">connected</span>
    <span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#print(&quot;Interactive mode&quot;, end=&quot;\n&quot;)</span>
    <span class="c1">#send(client_socket,host) # ne pas le mettre dans un thread pour qu&#39;il puisse gérer activement l&#39;input</span>
    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">receive</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span><span class="n">host</span><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">send</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span><span class="n">host</span><span class="p">)</span> <span class="c1"># ne pas le mettre dans un thread pour qu&#39;il puisse gérer activement l&#39;input</span>
    <span class="c1">#threading.Thread(target=send, args=(client_socket,host)).start()</span>
    
    <span class="k">return</span> <span class="mi">0</span> </div>

<div class="viewcode-block" id="get_ip">
<a class="viewcode-back" href="../client.html#client.get_ip">[docs]</a>
<span class="k">def</span> <span class="nf">get_ip</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction utilisant un socket afin d&#39;initier une connexion vers 8.8.8.8</span>
<span class="sd">    et récupérer l&#39;adresse IP de l&#39;interface utilisée.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        None</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: L&#39;adresse IP de l&#39;interface.</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception: Si la connexion échoue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># récupérer l&#39;adresse ip de l&#39;interface</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span></div>


<span class="c1"># Cette fonction a été générée par chatgpt</span>
<div class="viewcode-block" id="get_interface_name_by_ip">
<a class="viewcode-back" href="../client.html#client.get_interface_name_by_ip">[docs]</a>
<span class="k">def</span> <span class="nf">get_interface_name_by_ip</span><span class="p">(</span><span class="n">ip_address</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction générée par ChatGPT permettant de récupérer nom </span>
<span class="sd">    d&#39;une interface active</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        ip_address (str): L&#39;adresse IP de l&#39;interface.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: Le nom de l&#39;interface.</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Utiliser socket pour résoudre le nom d&#39;hôte associé à l&#39;adresse IP</span>
        <span class="n">hostname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>

        <span class="c1"># Utiliser psutil pour obtenir les informations sur les interfaces réseau</span>
        <span class="k">for</span> <span class="n">interface</span><span class="p">,</span> <span class="n">addrs</span> <span class="ow">in</span> <span class="n">psutil</span><span class="o">.</span><span class="n">net_if_addrs</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">addrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">addr</span><span class="o">.</span><span class="n">address</span> <span class="o">==</span> <span class="n">ip_address</span> <span class="ow">or</span> <span class="n">addr</span><span class="o">.</span><span class="n">address</span> <span class="o">==</span> <span class="n">hostname</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">interface</span>

        <span class="c1"># Si aucune correspondance n&#39;est trouvée</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">herror</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="c1"># Gérer les erreurs en cas de résolution d&#39;adresse IP ou si l&#39;adresse IP n&#39;est pas trouvée dans les interfaces</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="handle_announcement">
<a class="viewcode-back" href="../client.html#client.handle_announcement">[docs]</a>
<span class="k">def</span> <span class="nf">handle_announcement</span><span class="p">(</span><span class="n">pkt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction permettant de chercher l&#39;annoncement du serveur à travers le réseau</span>
<span class="sd">    sur une interface donnée et de récupérer l&#39;adresse IP et le port du serveur.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        pkt (packet): Le paquet reçu.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">UDP</span><span class="p">):</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">Raw</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Server announcement&quot;</span> <span class="ow">in</span> <span class="n">load</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received announcement:&quot;</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>
            <span class="n">server_ip</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span>
            <span class="n">server_port</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server IP:&quot;</span><span class="p">,</span> <span class="n">server_ip</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server Port:&quot;</span><span class="p">,</span> <span class="n">server_port</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connecting to host:&quot;</span><span class="p">,</span> <span class="n">server_ip</span><span class="p">,</span> <span class="s2">&quot;with port:&quot;</span><span class="p">,</span> <span class="n">server_port</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">server_ip</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">server_port</span><span class="p">)</span>
            
            <span class="n">main</span><span class="p">(</span><span class="n">server_ip</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">server_port</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

   

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Point d&#39;entrée du programme client (si exécuté en script)</span>
<span class="sd">    </span>
<span class="sd">    Récupérer les arguments de la ligne de commande et lancer le programme client.</span>
<span class="sd">    </span>
<span class="sd">    Si search est activé:</span>
<span class="sd">        vérifier si le client s&#39;exécute sur une machine virtuelle. Si ce n&#39;est pas le cas, rechercher des serveurs sur le réseau local en utilisant des paquets UDP.</span>
<span class="sd">        Puis s&#39;il y a un serveur trouvé, se connecter à celui-ci en utilisant l&#39;adresse et le port.</span>
<span class="sd">    Sinon:</span>
<span class="sd">        se connecter au serveur en utilisant l&#39;adresse et le port donnés en argument. (ou ceux par défaut)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
     <span class="c1"># commun à tous les clients</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">arg_parse</span><span class="p">()</span>
    <span class="n">host</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">client_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="c1"># Socket personnalisé</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">search</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">search</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vm_check</span> <span class="o">=</span> <span class="kc">True</span> \
            <span class="k">if</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="ow">in</span> <span class="n">getResults</span><span class="p">(</span><span class="s1">&#39;WMIC COMPUTERSYSTEM GET MODEL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
                <span class="ow">or</span> <span class="n">getResults</span><span class="p">(</span><span class="s2">&quot;WMIC BIOS GET SERIALNUMBER&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> \
                    <span class="k">else</span> <span class="kc">False</span> <span class="c1"># Vérifie si le client est dans une VM ou non.</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vm_check</span><span class="p">:</span>
            <span class="n">c_iface</span> <span class="o">=</span> <span class="n">get_interface_name_by_ip</span><span class="p">(</span><span class="n">get_ip</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;searching for server...&quot;</span><span class="p">)</span>
            <span class="n">client_ports</span> <span class="o">=</span> <span class="mi">9999</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;udp port </span><span class="si">{</span><span class="n">client_ports</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">sniff</span><span class="p">(</span><span class="n">prn</span><span class="o">=</span><span class="n">handle_announcement</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iface</span><span class="o">=</span><span class="n">c_iface</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">host</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">port</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;Impossible de trouver le serveur, vérifiez que le serveur est bien lancé sur le réseau local.&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;Vous ne pouvez pas lancer le client en mode recherche depuis une machine virtuelle.&quot;</span> <span class="o">+</span> <span class="n">Fore</span><span class="o">.</span><span class="n">YELLOW</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Il est important de noter que vous devriez mettre le serveur sur cette VM et les clients sur des machines physiques.(pour que ça puisse fonctionner)&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># si le client donne un argument ou plus </span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connecting to host: &quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s2">&quot;with port: &quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connecting to default host and port (localhost:1234)&quot;</span><span class="p">)</span>
        <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="c1"># lancer le client</span>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2023, iPresing.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>